<!DOCTYPE html>
<html lang="vi" ng-app="dahApp">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Qu·∫£n l√Ω khuy·∫øn m√£i - DAH</title>

  <!-- CSS -->
  <link rel="stylesheet" href="../style/QuanLyKhuyenMai.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />

  <!-- AngularJS 1.x (thay cho jQuery/axios tr√™n trang n√†y) -->
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular.min.js"></script>
  <script src="../angular/angular.min.js"></script>
  <!-- Optional n·ªÅn (v·∫´n gi·ªØ n·∫øu b·∫°n d√πng chung) -->
  <script src="../script/login.js"></script>
  <script src="../script/auth.js"></script>

  <!-- App Angular c·ªßa trang -->
  <script defer src="../script/QuanLyKhuyenMai.js"></script>
</head>
<body ng-controller="KhuyenMaiCtrl as vm">
  <div class="warp">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">DAH</div>
        <div><div>Qu·∫£n l√Ω b√°n l·∫ª v√† kho DAH</div></div>
      </div>

      <nav class="nav">
        <div class="section-title">ADMIN</div>
        <a href="QuanLyTaiKhoan.html">üõ†Ô∏è Qu·∫£n l√Ω t√†i kho·∫£n</a>
        <a href="QuanLyNhanVien.html">üßë‚Äçüíº Qu·∫£n l√Ω nh√¢n vi√™n</a>
        <a href="QuanLyKhuyenMai.html" class="active">üéÅ Qu·∫£n l√Ω khuy·∫øn m√£i</a>

        <div class="section-title" style="margin-top:20px;font-weight:700;">K·∫ø to√°n</div>
        <a href="../pages/QuanLyCongNo.html">üßæ Qu·∫£n l√Ω c√¥ng n·ª£</a>
        <a href="../pages/BaoCaoThongKe.html">üìä B√°o c√°o th·ªëng k√™</a>

        <div class="section-title">THU NG√ÇN</div>
        <a href="QuanLyBanHang.html">üßæ QU·∫¢N L√ù B√ÅN H√ÄNG</a>
        <a href="XuLyDoiTra.html">üîÅ X·ª¨ L√ù ƒê·ªîI TR·∫¢</a>

        <div class="section-title" style="margin-top:20px;font-weight:700;">Th·ªß kho</div>
        <a href="QuanLyDanhMuc.html">üì¶ Qu·∫£n l√Ω Danh m·ª•c</a>
        <a href="QuanLySanPham.html">üì¶ Qu·∫£n l√Ω S·∫£n ph·∫©m</a>
        <a href="QuanLyNhapKho.html">üì¶ Qu·∫£n l√Ω Nh·∫≠p kho</a>
        <a href="QuanLyTonKho.html">üì¶ Qu·∫£n l√Ω T·ªìn kho</a>
      </nav>

      <div class="section-title">T√†i kho·∫£n</div>
      <div class="quick-stats">
        <div class="row" style="justify-content:space-between">
          <span>Ng∆∞·ªùi d√πng:</span><strong>{{ vm.currentUser }}</strong>
        </div>
      </div>
      <div class="small muted">¬© DAH</div>
      <div class="logout">
        <a href="index.html">ƒêƒÉng xu·∫•t <i class="fa-solid fa-right-from-bracket"></i></a>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="main">
      <div class="header">
        <div>
          <div class="breadcrumbs">ADMIN / Qu·∫£n l√Ω khuy·∫øn m√£i</div>
          <h1 class="h1">QU·∫¢N L√ù KHUY·∫æN M√ÉI</h1>
        </div>
        <div class="actions"><div class="pill">Ng√¥n ng·ªØ: VN</div></div>
      </div>

      <!-- Danh s√°ch -->
      <section class="card">
        <div class="row" style="justify-content:space-between">
          <h2 class="h2">Danh s√°ch khuy·∫øn m√£i</h2>
          <div class="row" style="gap:10px;flex:1;justify-content:flex-end">
            <input class="input" ng-model="vm.searchText" placeholder="T√¨m theo MAKM, TENKM, MASP..." style="max-width:320px" />
            <a class="btn" href ng-click="vm.openAdd()">+ Th√™m khuy·∫øn m√£i</a>
          </div>
        </div>

        <div class="table-wrap" style="margin-top:10px">
          <table>
            <thead>
              <tr>
                <th>MAKM</th>
                <th>TENKM</th>
                <th>MASP</th>
                <th>NGAYBATDAU</th>
                <th>NGAYKETTHUC</th>
                <th style="width:160px">Thao t√°c</th>
              </tr>
            </thead>
            <tbody>
              <tr ng-if="!(vm.filtered && vm.filtered.length)">
                <td colspan="6" style="text-align:center">Kh√¥ng c√≥ d·ªØ li·ªáu</td>
              </tr>
              <tr ng-repeat="k in (vm.filtered = (vm.list | filter:vm.searchFilter)) | limitTo: vm.kmPerPage : (vm.page-1)*vm.kmPerPage track by k.maKM">
                <td>{{ k.maKM }}</td>
                <td>{{ k.tenKM }}</td>
                <td>{{ k.maSP }}</td>
                <td>{{ vm.toVN(k.ngayBD) }}</td>
                <td>{{ vm.toVN(k.ngayKT) }}</td>
                <td class="action-buttons">
                  <button class="icon-btn edit" title="S·ª≠a" ng-click="vm.openEdit(k)"><i class="fa-solid fa-pen-to-square"></i></button>
                  <button class="icon-btn delete" title="X√≥a" ng-click="vm.confirmDelete(k)"><i class="fa-solid fa-trash"></i></button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div id="km-pagination" style="margin-top:10px" ng-if="vm.filtered.length">
          <button ng-disabled="vm.page===1" ng-click="vm.page=vm.page-1">¬´</button>
          <button ng-repeat="p in vm.pages()" ng-class="{active: vm.page===p}" ng-click="vm.page=p">{{p}}</button>
          <button ng-disabled="vm.page===vm.totalPages()" ng-click="vm.page=vm.page+1">¬ª</button>
        </div>
      </section>

      <!-- Modal Th√™m -->
      <div id="kmAddModal" class="modal" ng-show="vm.modalAdd">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Th√™m khuy·∫øn m√£i</h3>
            <button class="close" ng-click="vm.closeAdd()">√ó</button>
          </div>
          <form ng-submit="vm.create()">
            <div class="row form-grid">
              <div>
                <label class="small muted">MAKM *</label>
                <input class="input" ng-model="vm.add.maKM" placeholder="VD: KM001" required />
              </div>
              <div>
                <label class="small muted">TENKM *</label>
                <input class="input" ng-model="vm.add.tenKM" placeholder="VD: Gi·∫£m 20% 2/9" required />
              </div>
              <div>
                <label class="small muted">MASP *</label>
                <input class="input" ng-model="vm.add.maSP" placeholder="VD: SP001" required />
              </div>
              <div>
                <label class="small muted">NGAYBATDAU *</label>
                <input type="date" class="input" ng-model="vm.add._start" required />
              </div>
              <div>
                <label class="small muted">NGAYKETTHUC *</label>
                <input type="date" class="input" ng-model="vm.add._end" required />
              </div>
            </div>
            <div class="row" style="gap:10px;justify-content:flex-end;margin-top:12px">
              <button type="button" class="btn secondary" ng-click="vm.closeAdd()">H·ªßy</button>
              <button type="submit" class="btn">L∆∞u</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Modal S·ª≠a -->
      <div id="kmEditModal" class="modal" ng-show="vm.modalEdit">
        <div class="modal-content">
          <div class="modal-header">
            <h3>S·ª≠a khuy·∫øn m√£i</h3>
            <button class="close" ng-click="vm.closeEdit()">√ó</button>
          </div>
          <form ng-submit="vm.update()">
            <div class="row form-grid">
              <div>
                <label class="small muted">MAKM *</label>
                <input class="input" ng-model="vm.edit.maKM" readonly />
              </div>
              <div>
                <label class="small muted">TENKM *</label>
                <input class="input" ng-model="vm.edit.tenKM" required />
              </div>
              <div>
                <label class="small muted">MASP *</label>
                <input class="input" ng-model="vm.edit.maSP" required />
              </div>
              <div>
                <label class="small muted">NGAYBATDAU *</label>
                <input type="date" class="input" ng-model="vm.edit._start" required />
              </div>
              <div>
                <label class="small muted">NGAYKETTHUC *</label>
                <input type="date" class="input" ng-model="vm.edit._end" required />
              </div>
            </div>
            <div class="row" style="gap:10px;justify-content:flex-end;margin-top:12px">
              <button type="button" class="btn secondary" ng-click="vm.closeEdit()">H·ªßy</button>
              <button type="submit" class="btn">L∆∞u</button>
            </div>
          </form>
        </div>
      </div>

    </main>
  </div>
</body>
</html>
