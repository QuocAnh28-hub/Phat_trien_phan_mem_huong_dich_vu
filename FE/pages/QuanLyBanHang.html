<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DAH ‚Äî Qu·∫£n l√Ω b√°n h√†ng (Thu ng√¢n)</title>
  <script src="../angular/angular.min.js"></script>
  <script src="../script/auth.js"></script>
  <script src="../script/login.js"></script>
  <script src="../script/QuanLyBanHang.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <link rel="stylesheet" href="../style/QuanLyBanHang.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body ng-app="dahApp" ng-controller="BanHangCtrl">
  <div class="warp">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">DAH</div>
        <div>Qu·∫£n l√Ω b√°n l·∫ª v√† kho DAH</div>
      </div>

      <nav class="nav">
        <div class="section-title">ADMIN</div>
        <a href="QuanLyTaiKhoan.html">üõ†Ô∏è Qu·∫£n l√Ω t√†i kho·∫£n</a>
        <a href="QuanLyNhanVien.html">üßë‚Äçüíº Qu·∫£n l√Ω nh√¢n vi√™n</a>
        <a href="QuanLyKhuyenMai.html">üéÅ Qu·∫£n l√Ω khuy·∫øn m√£i</a>

        <div class="section-title" style="margin-top:20px;font-weight:700;">K·∫ø to√°n</div>
        <a href="../pages/QuanLyCongNo.html">üßæ Qu·∫£n l√Ω c√¥ng n·ª£</a>
        <a href="../pages/BaoCaoThongKe.html">üìä B√°o c√°o th·ªëng k√™</a>

        <div class="section-title">THU NG√ÇN</div>
        <a href="QuanLyBanHang.html">üßæ QU·∫¢N L√ù B√ÅN H√ÄNG</a>
        <a href="XuLyDoiTra.html">üîÅ X·ª¨ L√ù ƒê·ªîI TR·∫¢</a>

        <div class="section-title" style="margin-top:20px;font-weight:700;">Th·ªß kho</div>
        <a href="QuanLyDanhMuc.html">üì¶ Qu·∫£n l√Ω Danh m·ª•c</a>
        <a href="QuanLySanPham.html">üì¶ Qu·∫£n l√Ω S·∫£n ph·∫©m</a>
        <a href="QuanLyNhapKho.html">üì¶ Qu·∫£n l√Ω Nh·∫≠p kho</a>
        <a href="QuanLyTonKho.html">üì¶ Qu·∫£n l√Ω T·ªìn kho</a>
      </nav>

      <div class="section-title">T√†i Kho·∫£n</div>
      <div class="quick-stats">
        <div class="row" style="justify-content:space-between">
          <span>Ng∆∞·ªùi d√πng:</span><strong>DAH</strong>
        </div>
      </div>
      <div class="small muted">¬© DAH</div>
      <div class="logout">
        <a href="index.html">ƒêƒÉng xu·∫•t <i class="fa-solid fa-right-from-bracket"></i></a>
      </div>
    </aside>

    <!-- Main -->
    <main class="main">
      <div class="header">
        <div>
          <div class="breadcrumbs">THU NG√ÇN / Qu·∫£n l√Ω b√°n h√†ng</div>
          <h1 class="h1">QU·∫¢N L√ù B√ÅN H√ÄNG</h1>
        </div>
        <div class="actions"><div class="pill">Ng√¥n ng·ªØ: VN</div></div>
      </div>

      <!-- ===== VIEW: T·∫°o h√≥a ƒë∆°n ===== -->
      <section id="tao-hoa-don" class="view is-active">
        <div class="card">
          <h3 class="h3">T·∫°o h√≥a ƒë∆°n m·ªõi</h3>

          <!-- Th√¥ng tin kh√°ch h√†ng -->
          <div class="row" style="gap:12px;flex-wrap:wrap">
            <div style="flex:1;min-width:150px">
              <div class="small muted">M√£ kh√°ch h√†ng</div>
              <input id="ma-kh" class="input" placeholder="VD: KH001"
                    ng-model="khachHang.ma"
                    ng-blur="kiemTraKhachHang()">
            </div>

            <div style="flex:1;min-width:200px">
              <div class="small muted">T√™n kh√°ch h√†ng</div>
              <input id="tenkh" class="input" ng-model="khachHang.ten"
                    placeholder="T√™n kh√°ch h√†ng"
                    ng-readonly="!khachHang.moi">
            </div>

            <div style="flex:1;min-width:200px">
              <div class="small muted">S·ªë ƒëi·ªán tho·∫°i</div>
              <input id="sdt" class="input" ng-model="khachHang.sdt"
                    placeholder="0999123456"
                    ng-readonly="!khachHang.moi">
            </div>

            <div style="flex:1;min-width:200px">
              <div class="small muted">ƒê·ªãa ch·ªâ</div>
              <input id="diachi" class="input" ng-model="khachHang.diachi"
                    placeholder="ƒê·ªãa ch·ªâ kh√°ch h√†ng"
                    ng-readonly="!khachHang.moi">
            </div>
          </div>

          <hr style="margin:20px 0;border:dashed 1px #ccc">

          <!-- Nh·∫≠p s·∫£n ph·∫©m -->
          <div class="row" style="gap:12px;align-items:flex-end;flex-wrap:wrap">
            <div>
              <div class="small muted">M√£ s·∫£n ph·∫©m</div>
              <input id="ma-sp" class="input" ng-model="sanPham.ma" placeholder="VD: SP001">
            </div>
            <div>
              <div class="small muted">S·ªë l∆∞·ª£ng</div>
              <input id="sl" class="input" type="number" min="1" ng-model="sanPham.sl" value="1">
            </div>
            <div>
              <button id="btn-them-sp" class="btn" ng-click="themSanPham()" style="cursor: pointer;">+ Th√™m s·∫£n ph·∫©m</button>
            </div>
          </div>

          <!-- B·∫£ng chi ti·∫øt -->
          <div class="table-wrap" style="margin-top:12px">
            <table id="bang-ct">
              <thead>
                <tr>
                  <th>M√É SP</th>
                  <th>T√äN S·∫¢N PH·∫®M</th>
                  <th>SL</th>
                  <th>GI√Å</th>
                  <th>TH√ÄNH TI·ªÄN</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="sp in danhSachCT track by $index">
                  <td>{{sp.masp}}</td>
                  <td>{{sp.tensp}}</td>
                  <td><input type="number" ng-model="sp.soluong" ng-change="capNhatTongTien()" min="1" style="width:60px"></td>
                  <td>{{sp.dongia | number}} ‚Ç´</td>
                  <td>{{sp.tongtien | number}} ‚Ç´</td>
                  <td><button class="btn small warn" ng-click="xoaSanPham($index)" style="cursor: pointer;">X√≥a</button></td>
                </tr>
              </tbody>
            </table>
          </div>

          <div style="text-align:right;margin-top:10px;font-weight:600">
            T·ªïng ti·ªÅn h√†ng: {{tongTien | number}} ‚Ç´
          </div>

          <div class="row" style="justify-content:flex-end;margin-top:12px;gap:8px">
            <a class="btn secondary" href="#hoa-don">H·ªßy</a>
            <a class="btn" id="btn-luu-hoa-don" ng-click="luuHoaDon()" style="cursor: pointer;">L∆∞u h√≥a ƒë∆°n</a>
          </div>
        </div>
      </section>

      <!-- ===== VIEW: Chi ti·∫øt h√≥a ƒë∆°n ===== -->
      <!-- ===== VIEW: Chi ti·∫øt h√≥a ƒë∆°n ===== -->
      <section id="chi-tiet" class="view">
        <div class="card">
          <h3 class="h3">Chi ti·∫øt h√≥a ƒë∆°n</h3>

          <!-- Th√¥ng tin kh√°ch h√†ng -->
          <div style="margin-bottom:14px" ng-if="hoaDonDaThanhToan">
            <strong>Kh√°ch h√†ng:</strong> {{hoaDonDaThanhToan.khachhang.ten}} <br>
            <strong>SƒêT:</strong> {{hoaDonDaThanhToan.khachhang.sdt}} <br>
            <strong>M√£ KH:</strong> {{hoaDonDaThanhToan.khachhang.ma}}
          </div>

          <!-- B·∫£ng s·∫£n ph·∫©m -->
          <div class="table-wrap" ng-if="hoaDonDaThanhToan">
            <table>
              <thead>
                <tr>
                  <th>M√É SP</th>
                  <th>T√äN S·∫¢N PH·∫®M</th>
                  <th>SL</th>
                  <th>ƒê∆†N GI√Å</th>
                  <th>VAT</th>
                  <th>TH√ÄNH TI·ªÄN</th>
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="sp in hoaDonDaThanhToan.sanpham">
                  <td>{{sp.masp}}</td>
                  <td>{{sp.tensp}}</td>
                  <td>{{sp.soluong}}</td>
                  <td>{{sp.dongia | number}} ‚Ç´</td>
                  <td>{{sp.vat | number}} ‚Ç´</td>
                  <td>{{sp.tongtien | number}} ‚Ç´</td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- T·ªïng ti·ªÅn -->
          <div style="margin-top:14px;text-align:right" ng-if="hoaDonDaThanhToan">
            <div>Thu·∫ø VAT: <b>{{hoaDonDaThanhToan.VAT | number}} ‚Ç´</b></div>
            <div>T·ªïng ti·ªÅn h√†ng: <b>{{hoaDonDaThanhToan.TongTien | number}} ‚Ç´</b></div>
            <div style="font-size:16px;font-weight:700;color:#007bff;margin-top:6px">
              Th√†nh ti·ªÅn: {{(hoaDonDaThanhToan.TongTien + hoaDonDaThanhToan.VAT) | number}} ‚Ç´
            </div>
          </div>

          <!-- N√∫t -->
          <div class="row" style="justify-content:flex-end;margin-top:12px;gap:8px">
            <a class="btn secondary" href="QuanLyBanHang.html">‚Üê Quay l·∫°i</a>
            <a class="btn" ng-click="inPDF()" style="cursor: pointer;">In h√≥a ƒë∆°n</a>
          </div>
        </div>
      </section>

    </main>
  </div>
  <!-- POPUP THANH TO√ÅN -->
  <div class="modal-overlay" ng-show="showPaymentModal">
    <div class="modal">
      <h3 class="modal-title">Ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n</h3>
      <div class="modal-body">
        <label class="radio-option">
          <input type="radio" ng-model="thanhToan.phuongThuc" value="Ti·ªÅn m·∫∑t"> Ti·ªÅn m·∫∑t
        </label>
        <label class="radio-option">
          <input type="radio" ng-model="thanhToan.phuongThuc" value="Chuy·ªÉn kho·∫£n"> Chuy·ªÉn kho·∫£n
        </label>
        <label class="radio-option">
          <input type="radio" ng-model="thanhToan.phuongThuc" value="Ghi n·ª£"> Ghi n·ª£
        </label>
      </div>
      <div class="modal-actions">
        <button class="btn" ng-click="xacNhanThanhToan()">X√°c nh·∫≠n</button>
      </div>
    </div>
  </div>
</body>
</html>